<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>KizBourges — Association de danse</title>
  <meta name="description" content="Site officiel de KizBourges : cours, événements, covoiturage et adhésion à Bourges.">
  <meta name="keywords" content="Kizomba Bourges, danse Bourges, cours kizomba, soirées kizomba, KizBourges">
  <meta property="og:title" content="KizBourges — Association de danse">
  <meta property="og:description" content="Cours, soirées & covoiturage à Bourges. Rejoins la communauté Kizomba !">
  <meta property="og:type" content="website">
  <meta property="og:image" content="Images/cover.jpg">
  <link rel="icon" type="image/png" href="Images/logo1.png">
  <link rel="stylesheet" href="styles.css">
  <style>
    @media (max-width: 768px) {
      .nav { display: none; }
      .nav.open { display: block; }
      #menu { font-size: 1.4rem; background:none; border:1px solid #ddd; padding:6px 10px; border-radius:8px; }
      .nav a { display:block; padding:10px 0; }
    }
    .adhesion-close {
      display:inline-block;
      margin-top:10px;
      padding:6px 12px;
      background:#eee;
      border:1px solid #ccc;
      border-radius:6px;
      cursor:pointer;
      font-size:14px;
    }
  </style>
</head>
<body>


  
  <div id="fb-root"></div>
  <script async defer crossorigin="anonymous"
    src="https://connect.facebook.net/fr_FR/sdk.js#xfbml=1&version=v19.0"
    nonce="kizbourges"></script>

  <!-- Header -->
  <header class="site-header">
    <div class="container">
      <a class="logo" href="./" aria-label="KizBourges">
        <img src="Images/logo1.png" alt="Logo KizBourges" class="logo-img" style="max-height:70px;">
      </a>
      <button id="menu" aria-label="Ouvrir le menu">☰</button>
      <nav id="nav" class="nav" aria-label="Navigation principale">
        <a href="#asso">L’asso</a>
        <a href="#cours">Cours & tarifs</a>
        <a href="#events">Événements</a>
        <a href="#covoit">Covoiturage</a>
        <a href="#son">Ambiance</a>
        <a href="#adhesion" onclick="toggleAdhesion(event)">Adhésion</a>
        <a href="#contact">Contact</a>
      </nav>
    </div>
  </header>

  <!-- Hero -->
  <section class="hero">
    <div class="container hero-inner">
      <h1>Bienvenue chez KizBourges</h1>
      <p>Kizomba, urban kiz & good vibes à Bourges ✨</p>
      <div class="cta-row">
        <a class="btn" href="#adhesion" onclick="toggleAdhesion(event)">Adhérer</a>
        <a class="btn alt" href="#events">Prochaines soirées</a>
      </div>
    </div>
  </section>

  <main>
    <!-- Association -->
    <section id="asso" class="section">
      <div class="container">
        <h2>L’association</h2>
        <p>KizBourges promeut la Kizomba à Bourges : cours hebdomadaires, stages et soirées sociales ouvertes à tous niveaux.</p>
      </div>
    </section>

    <!-- Cours & tarifs -->
    <section id="cours" class="section alt">
      <div class="container">
        <h2>Cours & tarifs</h2>
        <ul class="cards" role="list">
          <li class="card">
            <h3>Tous niveaux</h3>
            <p><strong>Quand :</strong> Mardi 20h–21h15</p>
            <p><strong>Où :</strong> Salle Baptiste Marcel, 2 Rue Parmentier, 18000 Bourges</p>
            <p><strong>Tarif :</strong> 10€ / cours ou 150€ / année</p>
          </li>
          <li class="card">
            <h3>Pratique — Tous niveaux</h3>
            <p><strong>Quand :</strong> Mardi 21h15–22h15</p>
            <p><strong>Où :</strong> Salle Baptiste Marcel, 2 Rue Parmentier, 18000 Bourges</p>
            <p>Inclus dans l’adhésion — selon planning.</p>
          </li>
          <li class="card course-ad">
  <div class="video-grid">
    <div class="copy">
      <h3>Découvre la Kizomba en 60 secondes</h3>
      <p>Ambiance, pas de base, bonne vibe — tout ce que tu verras au cours ✨</p>
      <div class="cta-row" style="margin-top:8px;">
        <a class="btn" href="#adhesion" onclick="toggleAdhesion(event)">S’inscrire / Adhérer</a>
        <a class="btn alt" href="#events">Voir les prochaines dates</a>
      </div>
    </div>

    <div class="media">
      <video
        id="courseAdVideo"
        class="course-video"
        title="KizBourges — Promo cours"
        playsinline
        muted
        loop
        preload="metadata"
        poster="Images/course-poster.jpg"
        controls
      >
        <source src="Videos/course-ad.mp4" type="video/mp4">
        Votre navigateur ne supporte pas la vidéo HTML5.
      </video>
    </div>
  </div>
</li>

        </ul>
      </div>
    </section>

    
<section id="events" class="section">
  <div class="container">
    <h2>Événements à venir</h2>

    <!-- START: KizBourges Events Slider (single instance) -->
    <div class="events-carousel" style="max-width:900px;margin:auto;position:relative;">
      <button id="ev-prev" aria-label="Événement précédent" class="ev-arrow"
        style="position:absolute;left:-8px;top:50%;transform:translateY(-50%);font-size:28px;cursor:pointer;border:none;background:transparent;">‹</button>

      <div class="ev-card" id="ev-card" style="padding:0 28px;text-align:center;">
        <a id="ev-link" href="#" target="_blank" rel="noopener" style="text-decoration:none;color:inherit;display:inline-block;">
          <img id="ev-img" src="" alt="Affiche de l’événement"
               loading="lazy"
               style="width:100%;max-height:460px;object-fit:cover;border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,.15);" />
          <h3 id="ev-title" style="margin:10px 0 6px;"></h3>
          <p id="ev-when" style="margin:0;color:#555;"></p>
          <p id="ev-where" style="margin:2px 0 0;color:#777;font-size:14px;"></p>
        </a>
        <div id="ev-cta" style="margin-top:10px;"></div>
      </div>

      <button id="ev-next" aria-label="Événement suivant" class="ev-arrow"
        style="position:absolute;right:-8px;top:50%;transform:translateY(-50%);font-size:28px;cursor:pointer;border:none;background:transparent;">›</button>
    </div>
    <div id="ev-dots" style="text-align:center;margin-top:12px;"></div>
    <div id="ev-list" class="cards" role="list" style="margin-top:22px;"></div>
    <!-- END: KizBourges Events Slider -->

    <!-- (Optional) Facebook embed below -->
    <!-- <div class="fb-page" ...> ... </div> -->
  </div>
</section>



    <!-- Covoiturage -->
    <section id="covoit" class="section alt">
      <div class="container">
        <h2>Covoiturage</h2>
        <p>Tu vas à une soirée ou un stage ? Propose ou cherche une place :</p>
        <p><a class="btn" href="https://forms.gle/PLACEHOLDER" target="_blank" rel="noopener">Formulaire covoiturage</a></p>
      </div>
    </section>

    <!-- Ambiance / SoundCloud (carousel) -->
    <section id="son" class="section">
      <div class="container">
        <h2>Ambiance musicale</h2>
        <p>Fais défiler nos playlists avec les flèches :</p>

        <div class="soundcloud-carousel" style="max-width:820px;margin:auto;position:relative;">
          <button id="sc-prev" aria-label="Playlist précédente" class="sc-arrow" style="position:absolute;left:-8px;top:50%;transform:translateY(-50%);font-size:28px;cursor:pointer;border:none;background:transparent;">‹</button>

          <div class="sc-player" style="padding:0 28px;">
            <h3 id="sc-title" style="text-align:center;margin-bottom:8px;">Kizomba</h3>
            <iframe id="sc-player" title="Playlist SoundCloud KizBourges" width="100%" height="450" scrolling="no" frameborder="no" allow="autoplay"
              src="https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/playlists/152611885&color=%23c4c4cc&auto_play=false&hide_related=false&show_comments=true&show_user=true&show_reposts=false&show_teaser=true"></iframe>
          </div>

          <button id="sc-next" aria-label="Playlist suivante" class="sc-arrow" style="position:absolute;right:-8px;top:50%;transform:translateY(-50%);font-size:28px;cursor:pointer;border:none;background:transparent;">›</button>
        </div>

        <script>
          // SoundCloud playlist carousel (with dots)
          (function(){
            const base = 'https://w.soundcloud.com/player/?url=';
            const tail = '&color=%23c4c4cc&auto_play=false&hide_related=false&show_comments=true&show_user=true&show_reposts=false&show_teaser=true';

            const playlists = [
              { title: 'Kizomba', url: base + encodeURIComponent('https://api.soundcloud.com/playlists/152611885') + tail },
              { title: 'Kizomba - Tarraxa', url: base + encodeURIComponent('https://api.soundcloud.com/playlists/124156830') + tail },
              { title: 'Kizomba - Urban', url: base + encodeURIComponent('https://api.soundcloud.com/playlists/323224243') + tail },
              { title: 'Kizomba - Douceur', url: base + encodeURIComponent('https://api.soundcloud.com/playlists/266791296') + tail },
              { title: 'Kizomba - Authentik', url: base + encodeURIComponent('https://soundcloud.com/danableu/sets/authentik') + tail },
              { title: 'Semba', url: base + encodeURIComponent('https://soundcloud.com/danableu/sets/semba') + tail }
            ];

            let idx = 0; // start with Kizomba
            const titleEl = document.getElementById('sc-title');
            const frameEl = document.getElementById('sc-player');
            const prevBtn = document.getElementById('sc-prev');
            const nextBtn = document.getElementById('sc-next');

            // Dots / indicators
            const carousel = document.querySelector('.soundcloud-carousel');
            const indicators = document.createElement('div');
            indicators.style.textAlign = 'center';
            indicators.style.marginTop = '10px';
            playlists.forEach((pl,i)=>{
              const dot = document.createElement('span');
              dot.textContent = '●';
              dot.style.cursor = 'pointer';
              dot.style.margin = '0 6px';
              dot.style.fontSize = '16px';
              dot.style.transition = 'transform 0.2s, color 0.2s';
              dot.addEventListener('click', ()=>{ idx=i; render(); });
              indicators.appendChild(dot);
            });
            carousel.appendChild(indicators);

            function updateDots(){
              [...indicators.children].forEach((dot,i)=>{
                if(i===idx){ dot.style.color = '#000'; dot.style.transform = 'scale(1.3)'; }
                else { dot.style.color = '#ccc'; dot.style.transform = 'scale(1)'; }
              });
            }

            function render(){
              titleEl.textContent = playlists[idx].title;
              if (frameEl && frameEl.src !== playlists[idx].url) {
                frameEl.src = playlists[idx].url;
              }
              updateDots();
            }

            function prev(){ idx = (idx - 1 + playlists.length) % playlists.length; render(); }
            function next(){ idx = (idx + 1) % playlists.length; render(); }

            prevBtn.addEventListener('click', prev);
            nextBtn.addEventListener('click', next);
            document.addEventListener('keydown', (e)=>{
              if (e.key === 'ArrowLeft') prev();
              if (e.key === 'ArrowRight') next();
            });

            render();
          })();
        </script>
      </div>
    </section>

    <!-- Adhésion (hidden by default) -->
    <section id="adhesion" class="section" style="display:none;">
      <div class="container">
        <h2>Adhésion</h2>
        <p>Rejoins l’association pour soutenir nos activités et profiter de tarifs membres.</p>
        <div class="ha-wrap" style="max-width:900px;margin:0 auto;">
          <iframe id="haWidget" title="Adhésion KizBourges sur HelloAsso" allowtransparency="true" src="https://www.helloasso.com/associations/amigos-latino/adhesions/kiz-bourges-2025-2026/widget" style="width: 100%; border: none;" onload="window.addEventListener('message', function(e){ if(e && e.data && e.data.height){ var el = document.getElementById('haWidget'); if(el){ el.height = e.data.height + 'px'; } } });"></iframe>
        </div>
        <button class="adhesion-close" onclick="toggleAdhesion(event)">Fermer ✕</button>
      </div>
    </section>

    <!-- Contact -->
    <section id="contact" class="section alt">
      <div class="container">
        <h2>Contact</h2>
        <p>Email : <a href="mailto:kizbourges@gmail.com">kizbourges@gmail.com</a></p>
        <p>Instagram : <a href="https://www.instagram.com/kizbourges?igsh=MTQyNW9udjh6Ym5raw==" target="_blank" rel="noopener">@kizbourges</a></p>
        <p>Facebook : <a href="https://www.facebook.com/KizBourges" target="_blank" rel="noopener">KizBourges</a></p>
        <div style="margin-top:24px;text-align:center;">
          <img src="Images/logo2.png" alt="Amigos Latino — Partenaire KizBourges" style="max-width:200px;display:inline-block;">
          <div style="font-size:14px;color:#666;margin-top:6px;">Partenaire — Amigos Latino</div>
        </div>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="site-footer">
    <div class="container">
      © <span id="year"></span> KizBourges — Tous droits réservés.
    </div>
  </footer>

  <script>
    // Mobile menu toggle
    (function(){
      var btn = document.getElementById('menu');
      var nav = document.getElementById('nav');
      if(btn && nav){
        btn.setAttribute('aria-expanded','false');
        btn.addEventListener('click', function(){
          var isOpen = nav.classList.toggle('open');
          btn.setAttribute('aria-expanded', isOpen ? 'true' : 'false');
        });
      }
    })();

    // Toggle adhesion section
    function toggleAdhesion(e){
      if(e) e.preventDefault();
      var section = document.getElementById("adhesion");
      if(section.style.display === "none" || section.style.display === ""){
        section.style.display = "block";
        section.scrollIntoView({behavior:"smooth"});
      } else {
        section.style.display = "none";
        window.scrollTo({top:0,behavior:"smooth"});
      }
    }

    // Footer year
    (function(){
      var y = document.getElementById('year');
      if (y && !y.textContent) { y.textContent = new Date().getFullYear(); }
    })();
  </script>

  <script src="script.js"></script>


<script defer src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script defer>
(function(){
  const CSV_URL = 'kizbourges_events_template1.csv?v=' + Date.now(); // cache-buster

  const img   = document.getElementById('ev-img');
  const title = document.getElementById('ev-title');
  const when  = document.getElementById('ev-when');
  const where = document.getElementById('ev-where');
  const link  = document.getElementById('ev-link');
  const cta   = document.getElementById('ev-cta');
  const prevB = document.getElementById('ev-prev');
  const nextB = document.getElementById('ev-next');
  const dots  = document.getElementById('ev-dots');
  const list  = document.getElementById('ev-list');

  let events = [], idx = 0;

  function fmtDate(iso){
    try {
      return new Date(iso).toLocaleString('fr-FR', {
        timeZone:'Europe/Paris', weekday:'short', day:'2-digit', month:'short', hour:'2-digit', minute:'2-digit'
      });
    } catch { return ''; }
  }

  function renderCarousel(){
    if (!events.length) return;
    const ev = events[idx];
    img.src  = ev.cover || 'Images/cover.jpg';
    img.alt  = `Affiche : ${ev.name || 'Événement'}`;
    title.textContent = ev.name || 'Événement';
    when.textContent  = ev.start_time ? fmtDate(ev.start_time) : '';
    where.textContent = ev.place?.name || ev.place || '—';
    link.href         = ev.event_url || '#';

    cta.innerHTML = '';
    if (ev.ticket_url){
      const a = document.createElement('a');
      a.href = ev.ticket_url; a.target = '_blank'; a.rel = 'noopener';
      a.className = 'btn'; a.textContent = 'Billetterie';
      cta.appendChild(a);
    }

    dots.querySelectorAll('span').forEach((dot,i)=>{
      dot.style.color = (i===idx)?'#000':'#ccc';
      dot.style.transform = (i===idx)?'scale(1.25)':'scale(1)';
    });
  }

  function renderDots(){
    dots.innerHTML = '';
    events.forEach((_, i)=>{
      const s = document.createElement('span');
      s.textContent = '●';
      s.style.cursor = 'pointer';
      s.style.margin = '0 6px';
      s.style.fontSize = '16px';
      s.style.transition = 'transform .2s, color .2s';
      s.addEventListener('click', ()=>{ idx = i; renderCarousel(); });
      dots.appendChild(s);
    });
  }

  function renderList(){
    list.innerHTML = '';
    events.forEach(ev=>{
      const card = document.createElement('div');
      card.className = 'card';
      card.style.display = 'grid';
      card.style.gridTemplateColumns = '120px 1fr';
      card.style.gap = '14px'; card.style.alignItems = 'center';

      const pic = document.createElement('img');
      pic.src = ev.cover || 'Images/cover.jpg';
      pic.alt = `Affiche : ${ev.name || 'Événement'}`;
      pic.loading = 'lazy';
      pic.style.width = '120px'; pic.style.height = '80px';
      pic.style.objectFit = 'cover'; pic.style.borderRadius = '8px';

      const meta = document.createElement('div');
      const h3 = document.createElement('h3'); h3.textContent = ev.name || 'Événement';
      const p1 = document.createElement('p'); p1.style.margin='4px 0'; p1.textContent = ev.start_time ? fmtDate(ev.start_time) : '';
      const p2 = document.createElement('p'); p2.style.margin='2px 0'; p2.style.color='#666'; p2.textContent = ev.place?.name || ev.place || '—';

      const row = document.createElement('div'); row.style.marginTop = '6px';
      if (ev.event_url){ const a1 = document.createElement('a'); a1.href=ev.event_url; a1.target='_blank'; a1.rel='noopener'; a1.className='btn alt'; a1.textContent='Détails'; row.appendChild(a1); }
      if (ev.ticket_url){ const a2 = document.createElement('a'); a2.href=ev.ticket_url; a2.target='_blank'; a2.rel='noopener'; a2.className='btn'; a2.style.marginLeft='8px'; a2.textContent='Billets'; row.appendChild(a2); }

      meta.append(h3,p1,p2,row);
      card.append(pic,meta);
      list.appendChild(card);
    });
  }

  function prev(){ if(!events.length) return; idx = (idx - 1 + events.length) % events.length; renderCarousel(); }
  function next(){ if(!events.length) return; idx = (idx + 1) % events.length; renderCarousel(); }

  prevB.addEventListener('click', prev);
  nextB.addEventListener('click', next);
  document.addEventListener('keydown', e=>{ if(e.key==='ArrowLeft')prev(); if(e.key==='ArrowRight')next(); });

  Papa.parse(CSV_URL, {
    download: true,
    header: true,
    skipEmptyLines: true,
    // If your CSV uses semicolons, uncomment:
    // delimiter: ';',
    complete: ({ data }) => {
      // CSV headers: id,name,start_time,place,cover,event_url,ticket_url
      events = data.map(r => ({
        id: r.id || r.name,
        name: r.name,
        start_time: r.start_time,
        place: r.place ? { name: r.place } : { name: '' },
        cover: r.cover,
        event_url: r.event_url,
        ticket_url: r.ticket_url
      }))
      .filter(ev => ev.name)
      .sort((a,b) => new Date(a.start_time || 0) - new Date(b.start_time || 0));

      if (!events.length) return;
      renderDots(); renderCarousel(); renderList();
      console.log('Loaded events:', events.length);
    },
    error: err => console.error('CSV load error:', err)
  });
})();
</script>

<script defer src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script defer>
(function(){
  const CSV_URL = 'kizbourges_events_template1.csv?v=' + Date.now();

  // ---- DOM (must match your single slider) ----
  const img   = document.getElementById('ev-img');
  const title = document.getElementById('ev-title');
  const when  = document.getElementById('ev-when');
  const where = document.getElementById('ev-where');
  const link  = document.getElementById('ev-link');
  const cta   = document.getElementById('ev-cta');
  const prevB = document.getElementById('ev-prev');
  const nextB = document.getElementById('ev-next');
  const dots  = document.getElementById('ev-dots');
  const list  = document.getElementById('ev-list');

  let events = [], idx = 0;

  // -------- helpers (robust CSV + images) --------
  function detectDelimiter(text){
    const header = text.split(/\r?\n/,1)[0] || '';
    const semis  = (header.match(/;/g)||[]).length;
    const commas = (header.match(/,/g)||[]).length;
    return semis > commas ? ';' : ',';
  }
  function normalizeCover(url){
    if(!url) return '';
    url = url.trim();
    // remove leading slash (breaks GitHub Pages project path)
    if (url.startsWith('/')) url = url.slice(1);
    // fix GitHub blob -> raw
    if (/^https?:\/\/github\.com\/.+\/blob\//i.test(url)) {
      url = url.replace(/^https?:\/\/github\.com\//i,'https://raw.githubusercontent.com/').replace('/blob/','/');
    }
    // try to fix images vs Images case if needed
    if (url.startsWith('images/')) url = 'Images/' + url.slice(7);
    return url;
  }
  function fmtDate(iso){
    if(!iso) return '';
    const d = new Date(iso);
    return isNaN(d) ? '' : d.toLocaleString('fr-FR', {
      timeZone:'Europe/Paris', weekday:'short', day:'2-digit', month:'short',
      hour:'2-digit', minute:'2-digit'
    });
  }

  function renderCarousel(){
    if(!events.length) return;
    const ev = events[idx];

    img.onerror = () => { img.onerror = null; img.src = 'Images/cover.jpg'; };
    img.src  = ev.cover || 'Images/cover.jpg';
    img.alt  = `Affiche : ${ev.name || 'Événement'}`;
    title.textContent = ev.name || 'Événement';
    when.textContent  = fmtDate(ev.start_time);
    where.textContent = ev.place?.name || ev.place || '—';
    link.href         = ev.event_url || '#';

    cta.innerHTML = '';
    if (ev.ticket_url){
      const a = document.createElement('a');
      a.href = ev.ticket_url; a.target='_blank'; a.rel='noopener';
      a.className='btn'; a.textContent='Billetterie';
      cta.appendChild(a);
    }

    dots.querySelectorAll('span').forEach((dot,i)=>{
      dot.style.color = (i===idx)?'#000':'#ccc';
      dot.style.transform = (i===idx)?'scale(1.25)':'scale(1)';
    });
  }

  function renderDots(){
    dots.innerHTML = '';
    events.forEach((_, i)=>{
      const s = document.createElement('span');
      s.textContent='●';
      s.style.cursor='pointer'; s.style.margin='0 6px'; s.style.fontSize='16px';
      s.style.transition='transform .2s, color .2s';
      s.addEventListener('click', ()=>{ idx=i; renderCarousel(); });
      dots.appendChild(s);
    });
  }

  function renderList(){
    list.innerHTML='';
    events.forEach(ev=>{
      const card=document.createElement('div');
      card.className='card';
      card.style.display='grid';
      card.style.gridTemplateColumns='120px 1fr';
      card.style.gap='14px'; card.style.alignItems='center';

      const pic=document.createElement('img');
      pic.onerror = () => { pic.onerror = null; pic.src = 'Images/cover.jpg'; };
      pic.src=ev.cover||'Images/cover.jpg';
      pic.alt=`Affiche : ${ev.name||'Événement'}`;
      pic.loading='lazy'; pic.style.width='120px'; pic.style.height='80px';
      pic.style.objectFit='cover'; pic.style.borderRadius='8px';

      const meta=document.createElement('div');
      const h3=document.createElement('h3'); h3.textContent=ev.name||'Événement';
      const p1=document.createElement('p'); p1.style.margin='4px 0'; p1.textContent=fmtDate(ev.start_time);
      const p2=document.createElement('p'); p2.style.margin='2px 0'; p2.style.color='#666'; p2.textContent=ev.place?.name||ev.place||'—';

      const row=document.createElement('div'); row.style.marginTop='6px';
      if(ev.event_url){ const a1=document.createElement('a'); a1.href=ev.event_url; a1.target='_blank'; a1.rel='noopener'; a1.className='btn alt'; a1.textContent='Détails'; row.appendChild(a1); }
      if(ev.ticket_url){ const a2=document.createElement('a'); a2.href=ev.ticket_url; a2.target='_blank'; a2.rel='noopener'; a2.className='btn'; a2.style.marginLeft='8px'; a2.textContent='Billets'; row.appendChild(a2); }

      meta.append(h3,p1,p2,row);
      card.append(pic,meta);
      list.appendChild(card);
    });
  }

  function prev(){ if(!events.length) return; idx=(idx-1+events.length)%events.length; renderCarousel(); }
  function next(){ if(!events.length) return; idx=(idx+1)%events.length; renderCarousel(); }
  prevB.addEventListener('click', prev);
  nextB.addEventListener('click', next);
  document.addEventListener('keydown', e=>{ if(e.key==='ArrowLeft')prev(); if(e.key==='ArrowRight')next(); });

  // -------- load CSV (auto-detect delimiter) --------
  fetch(CSV_URL)
    .then(r => r.text())
    .then(text => {
      const delimiter = detectDelimiter(text);
      const parsed = Papa.parse(text, { header:true, skipEmptyLines:true, delimiter });
      let rows = parsed.data.map(row => {
        const o = {};
        for (const k in row) if (Object.hasOwn(row, k)) {
          const key = (k||'').trim();
          const val = typeof row[k]==='string' ? row[k].trim() : row[k];
          o[key] = val;
        }
        return o;
      });

      events = rows.map(r => ({
        id: r.id || r.name,
        name: r.name,
        start_time: r.start_time,
        place: r.place ? { name: r.place } : { name: '' },
        cover: normalizeCover(r.cover || ''),
        event_url: r.event_url,
        ticket_url: r.ticket_url
      }))
      .filter(ev => ev.name)
      .sort((a,b)=> new Date(a.start_time||0) - new Date(b.start_time||0));

      console.log('CSV delimiter:', delimiter, 'events parsed:', events.length);
      if (!events.length) {
        console.error('No events found. CSV headers must be: id,name,start_time,place,cover,event_url,ticket_url');
        return;
      }
      renderDots(); renderCarousel(); renderList();
    })
    .catch(err => console.error('CSV load error:', err));
})();
</script>

</body>
</html>
